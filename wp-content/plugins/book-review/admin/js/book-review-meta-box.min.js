var file_frame;jQuery(document).ready(function(e){function r(r,o){e.trim(r.val())||null===o||r.val(o)}e(".upload-image-button").on("click",function(r){return r.preventDefault(),file_frame?void file_frame.open():(file_frame=wp.media.frames.file_frame=wp.media({title:e(this).data("uploader_title"),button:{text:e(this).data("uploader_button_text")},multiple:!1}),file_frame.on("select",function(){attachment=file_frame.state().get("selection").first().toJSON(),e("#book_review_cover_url").val(attachment.url),e("#book_review_cover_image").attr("src",attachment.url).show()}),void file_frame.open())}),e("#book_review_cover_url").on("change",function(r){""!==e(this).val()?e("#book_review_cover_image").attr("src",e(this).val()).show():e("#book_review_cover_image").attr("src","").hide()}),e("#get-book-info").on("click",function(o){var t=null,a="",i="",n={action:"get_book_info",nonce:e("#ajax_isbn_nonce").text(),isbn:e("#book_review_isbn").val()};return e.trim(e("#book_review_isbn").val())?(e(".error-details").hide(),e("#book-review-meta-box .spinner").addClass("is-active"),e.post(ajaxurl,n,function(o){var n,s,l=0;e("#book-review-meta-box .spinner").removeClass("is-active");try{if(n=JSON.parse(o),n.hasOwnProperty("data")&&n.hasOwnProperty("status")&&"success"===n.status)if(s=JSON.parse(n.data),s.hasOwnProperty("items")&&s.items.constructor===Array&&s.items.length>0&&s.items[0].hasOwnProperty("volumeInfo")){if(t=s.items[0].volumeInfo,t.hasOwnProperty("title")&&r(e("#book_review_title"),t.title),t.hasOwnProperty("authors")&&t.authors.constructor===Array&&!e.trim(e("#book_review_author").val())){for(l=0;l<t.authors.length;l++)a+=t.authors[l],t.authors.length>1&&(a+=", ");e("#book_review_author").val(a)}if(t.hasOwnProperty("categories")&&t.categories.constructor===Array&&!e.trim(e("#book_review_genre").val())){for(l=0;l<t.categories.length;l++)i+=t.categories[l],t.categories.length>1&&(i+=", ");e("#book_review_genre").val(i)}if(t.hasOwnProperty("publisher")&&r(e("#book_review_publisher"),t.publisher),n.releaseDate&&r(e("#book_review_release_date"),n.releaseDate),t.hasOwnProperty("pageCount")&&r(e("#book_review_pages"),t.pageCount),t.hasOwnProperty("imageLinks")&&t.imageLinks.hasOwnProperty("thumbnail")&&!e.trim(e("#book_review_cover_url").val())&&(e("#book_review_cover_url").val(t.imageLinks.thumbnail),e("#book_review_cover_image").attr("src",t.imageLinks.thumbnail).show()),t.hasOwnProperty("description")&&"undefined"!=typeof tinymce){var _=tinymce.get("book_review_summary");_&&_ instanceof tinymce.Editor?e.trim(_.getContent())||(_.setContent(t.description),_.save({no_events:!0})):e.trim(e("textarea#book_review_summary").val())||e("textarea#book_review_summary").val(t.description)}}else e(".error-details").text(book_review_google_api.not_found).show(),console.log(s);else n.hasOwnProperty("status")&&"error"===n.status&&(e(".error-details").html(book_review_google_api.unknown_error).show(),n.hasOwnProperty("data")&&console.log("Error message: "+n.data))}catch(v){console.log("JSON parsing error: "+v)}})):e(".error-details").text(book_review_google_api.no_isbn).show(),!1})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvb2stcmV2aWV3LW1ldGEtYm94LmpzIl0sIm5hbWVzIjpbImZpbGVfZnJhbWUiLCJqUXVlcnkiLCJkb2N1bWVudCIsInJlYWR5IiwiJCIsInNldEZpZWxkIiwiJGVsZW0iLCJ2YWx1ZSIsInRyaW0iLCJ2YWwiLCJvbiIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJvcGVuIiwid3AiLCJtZWRpYSIsImZyYW1lcyIsInRpdGxlIiwidGhpcyIsImRhdGEiLCJidXR0b24iLCJ0ZXh0IiwibXVsdGlwbGUiLCJhdHRhY2htZW50Iiwic3RhdGUiLCJnZXQiLCJmaXJzdCIsInRvSlNPTiIsInVybCIsImF0dHIiLCJzaG93IiwiaGlkZSIsInZvbHVtZSIsImF1dGhvciIsImdlbnJlIiwiYWN0aW9uIiwibm9uY2UiLCJpc2JuIiwiYWRkQ2xhc3MiLCJwb3N0IiwiYWpheHVybCIsInJlc3BvbnNlIiwianNvbiIsImkiLCJyZW1vdmVDbGFzcyIsIkpTT04iLCJwYXJzZSIsImhhc093blByb3BlcnR5Iiwic3RhdHVzIiwiaXRlbXMiLCJjb25zdHJ1Y3RvciIsIkFycmF5IiwibGVuZ3RoIiwidm9sdW1lSW5mbyIsImF1dGhvcnMiLCJjYXRlZ29yaWVzIiwicHVibGlzaGVyIiwicmVsZWFzZURhdGUiLCJwYWdlQ291bnQiLCJpbWFnZUxpbmtzIiwidGh1bWJuYWlsIiwidGlueW1jZSIsImVkaXRvciIsIkVkaXRvciIsImdldENvbnRlbnQiLCJzZXRDb250ZW50IiwiZGVzY3JpcHRpb24iLCJzYXZlIiwibm9fZXZlbnRzIiwiYm9va19yZXZpZXdfZ29vZ2xlX2FwaSIsIm5vdF9mb3VuZCIsImNvbnNvbGUiLCJsb2ciLCJodG1sIiwidW5rbm93bl9lcnJvciIsImUiLCJub19pc2JuIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFJQSxXQUVKQyxRQUFPQyxVQUFVQyxNQUFNLFNBQVNDLEdBMks5QixRQUFTQyxHQUFTQyxFQUFPQyxHQUNsQkgsRUFBRUksS0FBS0YsRUFBTUcsUUFB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QixXQUl2QzFCLEVBQU9lLGVBQWUsZUFBaUJmLEVBQU8yQixXQUFXWixlQUFlLGVBQ3pFM0MsRUFBRUksS0FBS0osRUFBRSwwQkFBMEJLLFNBQ3BDTCxFQUFFLDBCQUEwQkssSUFBSXVCLEVBQU8yQixXQUFXQyxXQUNsRHhELEVBQUUsNEJBQTRCeUIsS0FBSyxNQUFPRyxFQUFPMkIsV0FBV0MsV0FBVzlCLFFBSXJFRSxFQUFPZSxlQUFlLGdCQUNELG1CQUFaYyxTQUF5QixDQUNsQyxHQUFJQyxHQUFTRCxRQUFRcEMsSUFBSSxzQkFFckJxQyxJQUFVQSxZQUFrQkQsU0FBUUUsT0FDakMzRCxFQUFFSSxLQUFLc0QsRUFBT0UsZ0JBQ2pCRixFQUFPRyxXQUFXakMsRUFBT2tDLGFBQ3pCSixFQUFPSyxNQUFPQyxXQUFXLEtBSXRCaEUsRUFBRUksS0FBS0osRUFBRSxnQ0FBZ0NLLFFBQzVDTCxFQUFFLGdDQUFnQ0ssSUFBSXVCLEVBQU9rQyxrQkFPckQ5RCxHQUFFLGtCQUFrQmlCLEtBQUtnRCx1QkFBdUJDLFdBQVd4QyxPQUMzRHlDLFFBQVFDLElBQUlyRCxPQUdQdUIsR0FBS0ssZUFBZSxXQUE4QixVQUFoQkwsRUFBS00sU0FDOUM1QyxFQUFFLGtCQUFrQnFFLEtBQUtKLHVCQUF1QkssZUFBZTVDLE9BRTNEWSxFQUFLSyxlQUFlLFNBQ3RCd0IsUUFBUUMsSUFBSSxrQkFBb0I5QixFQUFLdkIsT0FJM0MsTUFBT3dELEdBQ0xKLFFBQVFDLElBQUksdUJBQXlCRyxPQTlHekN2RSxFQUFFLGtCQUFrQmlCLEtBQUtnRCx1QkFBdUJPLFNBQVM5QyxRQW1IcEQiLCJmaWxlIjoiYm9vay1yZXZpZXctbWV0YS1ib3guanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZmlsZV9mcmFtZTtcblxualF1ZXJ5KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigkKSB7XG4gIC8vIFVwbG9hZGluZyBmaWxlc1xuICAkKFwiLnVwbG9hZC1pbWFnZS1idXR0b25cIikub24oXCJjbGlja1wiLCBmdW5jdGlvbihldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAvLyBJZiB0aGUgbWVkaWEgZnJhbWUgYWxyZWFkeSBleGlzdHMsIHJlb3BlbiBpdC5cbiAgICBpZiAoZmlsZV9mcmFtZSkge1xuICAgICAgZmlsZV9mcmFtZS5vcGVuKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIHRoZSBtZWRpYSBmcmFtZS5cbiAgICBmaWxlX2ZyYW1lID0gd3AubWVkaWEuZnJhbWVzLmZpbGVfZnJhbWUgPSB3cC5tZWRpYSh7XG4gICAgICB0aXRsZTogJCh0aGlzKS5kYXRhKFwidXBsb2FkZXJfdGl0bGVcIiksXG4gICAgICBidXR0b246IHtcbiAgICAgICAgdGV4dDogJCh0aGlzKS5kYXRhKFwidXBsb2FkZXJfYnV0dG9uX3RleHRcIiksXG4gICAgICB9LFxuICAgICAgLy8gU2V0IHRvIHRydWUgdG8gYWxsb3cgbXVsdGlwbGUgZmlsZXMgdG8gYmUgc2VsZWN0ZWQuXG4gICAgICBtdWx0aXBsZTogZmFsc2VcbiAgICB9KTtcblxuICAgIC8vIFdoZW4gYW4gaW1hZ2UgaXMgc2VsZWN0ZWQsIHJ1biBhIGNhbGxiYWNrLlxuICAgIGZpbGVfZnJhbWUub24oXCJzZWxlY3RcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBhdHRhY2htZW50ID0gZmlsZV9mcmFtZS5zdGF0ZSgpLmdldChcInNlbGVjdGlvblwiKS5maXJzdCgpLnRvSlNPTigpO1xuICAgICAgJChcIiNib29rX3Jldmlld19jb3Zlcl91cmxcIikudmFsKGF0dGFjaG1lbnQudXJsKTtcbiAgICAgICQoXCIjYm9va19yZXZpZXdfY292ZXJfaW1hZ2VcIikuYXR0cihcInNyY1wiLCBhdHRhY2htZW50LnVybCkuc2hvdygpO1xuICAgIH0pO1xuXG4gICAgLy8gRmluYWxseSwgb3BlbiB0aGUgbW9kYWwuXG4gICAgZmlsZV9mcmFtZS5vcGVuKCk7XG4gIH0pO1xuXG4gICQoXCIjYm9va19yZXZpZXdfY292ZXJfdXJsXCIpLm9uKFwiY2hhbmdlXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgaWYgKCQodGhpcykudmFsKCkgIT09IFwiXCIpIHtcbiAgICAgICQoXCIjYm9va19yZXZpZXdfY292ZXJfaW1hZ2VcIikuYXR0cihcInNyY1wiLCAkKHRoaXMpLnZhbCgpKS5zaG93KCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgJChcIiNib29rX3Jldmlld19jb3Zlcl9pbWFnZVwiKS5hdHRyKFwic3JjXCIsIFwiXCIpLmhpZGUoKTtcbiAgICB9XG4gIH0pO1xuXG4gICQoXCIjZ2V0LWJvb2staW5mb1wiKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgdmFyIHZvbHVtZSA9IG51bGw7XG4gICAgdmFyIGF1dGhvciA9IFwiXCI7XG4gICAgdmFyIGdlbnJlID0gXCJcIjtcbiAgICB2YXIgZGF0YSA9IHtcbiAgICAgIGFjdGlvbjogXCJnZXRfYm9va19pbmZvXCIsXG4gICAgICBub25jZTogJChcIiNhamF4X2lzYm5fbm9uY2VcIikudGV4dCgpLFxuICAgICAgaXNibjogJChcIiNib29rX3Jldmlld19pc2JuXCIpLnZhbCgpXG4gICAgfTtcblxuICAgIGlmICghJC50cmltKCQoXCIjYm9va19yZXZpZXdfaXNiblwiKS52YWwoKSkpIHtcbiAgICAgICQoXCIuZXJyb3ItZGV0YWlsc1wiKS50ZXh0KGJvb2tfcmV2aWV3X2dvb2dsZV9hcGkubm9faXNibikuc2hvdygpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICQoXCIuZXJyb3ItZGV0YWlsc1wiKS5oaWRlKCk7XG4gICAgICAkKFwiI2Jvb2stcmV2aWV3LW1ldGEtYm94IC5zcGlubmVyXCIpLmFkZENsYXNzKFwiaXMtYWN0aXZlXCIpO1xuXG4gICAgICAkLnBvc3QoYWpheHVybCwgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgdmFyIGpzb24sIGRhdGEsIGkgPSAwO1xuXG4gICAgICAgICQoXCIjYm9vay1yZXZpZXctbWV0YS1ib3ggLnNwaW5uZXJcIikucmVtb3ZlQ2xhc3MoXCJpcy1hY3RpdmVcIik7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBqc29uID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG5cbiAgICAgICAgICBpZiAoanNvbi5oYXNPd25Qcm9wZXJ0eShcImRhdGFcIikgJiYganNvbi5oYXNPd25Qcm9wZXJ0eShcInN0YXR1c1wiKSAmJiAoanNvbi5zdGF0dXMgPT09IFwic3VjY2Vzc1wiKSkge1xuICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoanNvbi5kYXRhKTtcblxuICAgICAgICAgICAgLy8gQ2hlY2sgdGhhdCBkYXRhIGhhcyBiZWVuIHJldHVybmVkLlxuICAgICAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoXCJpdGVtc1wiKSAmJiAoZGF0YS5pdGVtcy5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpICYmXG4gICAgICAgICAgICAgIChkYXRhLml0ZW1zLmxlbmd0aCA+IDApICYmIGRhdGEuaXRlbXNbMF0uaGFzT3duUHJvcGVydHkoXCJ2b2x1bWVJbmZvXCIpKSB7XG4gICAgICAgICAgICAgIHZvbHVtZSA9IGRhdGEuaXRlbXNbMF0udm9sdW1lSW5mbztcblxuICAgICAgICAgICAgICAvLyBUaXRsZVxuICAgICAgICAgICAgICBpZiAodm9sdW1lLmhhc093blByb3BlcnR5KFwidGl0bGVcIikpIHtcbiAgICAgICAgICAgICAgICBzZXRGaWVsZCgkKFwiI2Jvb2tfcmV2aWV3X3RpdGxlXCIpLCB2b2x1bWUudGl0bGUpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8gQXV0aG9yXG4gICAgICAgICAgICAgIGlmICh2b2x1bWUuaGFzT3duUHJvcGVydHkoXCJhdXRob3JzXCIpICYmICh2b2x1bWUuYXV0aG9ycy5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpICYmXG4gICAgICAgICAgICAgICAgISQudHJpbSgkKFwiI2Jvb2tfcmV2aWV3X2F1dGhvclwiKS52YWwoKSkpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdm9sdW1lLmF1dGhvcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgIGF1dGhvciArPSB2b2x1bWUuYXV0aG9yc1tpXTtcblxuICAgICAgICAgICAgICAgICAgaWYgKHZvbHVtZS5hdXRob3JzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgYXV0aG9yICs9IFwiLCBcIjtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkKFwiI2Jvb2tfcmV2aWV3X2F1dGhvclwiKS52YWwoYXV0aG9yKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIC8vIEdlbnJlXG4gICAgICAgICAgICAgIGlmICh2b2x1bWUuaGFzT3duUHJvcGVydHkoXCJjYXRlZ29yaWVzXCIpICYmICh2b2x1bWUuY2F0ZWdvcmllcy5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpICYmXG4gICAgICAgICAgICAgICAgISQudHJpbSgkKFwiI2Jvb2tfcmV2aWV3X2dlbnJlXCIpLnZhbCgpKSkge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB2b2x1bWUuY2F0ZWdvcmllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgZ2VucmUgKz0gdm9sdW1lLmNhdGVnb3JpZXNbaV07XG5cbiAgICAgICAgICAgICAgICAgIGlmICh2b2x1bWUuY2F0ZWdvcmllcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGdlbnJlICs9IFwiLCBcIjtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkKFwiI2Jvb2tfcmV2aWV3X2dlbnJlXCIpLnZhbChnZW5yZSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAvLyBQdWJsaXNoZXJcbiAgICAgICAgICAgICAgaWYgKHZvbHVtZS5oYXNPd25Qcm9wZXJ0eShcInB1Ymxpc2hlclwiKSkge1xuICAgICAgICAgICAgICAgIHNldEZpZWxkKCQoXCIjYm9va19yZXZpZXdfcHVibGlzaGVyXCIpLCB2b2x1bWUucHVibGlzaGVyKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIC8vIFJlbGVhc2UgRGF0ZVxuICAgICAgICAgICAgICBpZiAoanNvbi5yZWxlYXNlRGF0ZSkge1xuICAgICAgICAgICAgICAgIHNldEZpZWxkKCQoXCIjYm9va19yZXZpZXdfcmVsZWFzZV9kYXRlXCIpLCBqc29uLnJlbGVhc2VEYXRlKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIC8vIFBhZ2VzXG4gICAgICAgICAgICAgIGlmICh2b2x1bWUuaGFzT3duUHJvcGVydHkoXCJwYWdlQ291bnRcIikpIHtcbiAgICAgICAgICAgICAgICBzZXRGaWVsZCgkKFwiI2Jvb2tfcmV2aWV3X3BhZ2VzXCIpLCB2b2x1bWUucGFnZUNvdW50KTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIC8vIENvdmVyIFVSTFxuICAgICAgICAgICAgICBpZiAodm9sdW1lLmhhc093blByb3BlcnR5KFwiaW1hZ2VMaW5rc1wiKSAmJiB2b2x1bWUuaW1hZ2VMaW5rcy5oYXNPd25Qcm9wZXJ0eShcInRodW1ibmFpbFwiKSAmJlxuICAgICAgICAgICAgICAgICEkLnRyaW0oJChcIiNib29rX3Jldmlld19jb3Zlcl91cmxcIikudmFsKCkpKSB7XG4gICAgICAgICAgICAgICAgJChcIiNib29rX3Jldmlld19jb3Zlcl91cmxcIikudmFsKHZvbHVtZS5pbWFnZUxpbmtzLnRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgJChcIiNib29rX3Jldmlld19jb3Zlcl9pbWFnZVwiKS5hdHRyKFwic3JjXCIsIHZvbHVtZS5pbWFnZUxpbmtzLnRodW1ibmFpbCkuc2hvdygpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8gU3lub3BzaXNcbiAgICAgICAgICAgICAgaWYgKHZvbHVtZS5oYXNPd25Qcm9wZXJ0eShcImRlc2NyaXB0aW9uXCIpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0aW55bWNlICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICB2YXIgZWRpdG9yID0gdGlueW1jZS5nZXQoXCJib29rX3Jldmlld19zdW1tYXJ5XCIpO1xuXG4gICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yICYmIGVkaXRvciBpbnN0YW5jZW9mIHRpbnltY2UuRWRpdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghJC50cmltKGVkaXRvci5nZXRDb250ZW50KCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnNldENvbnRlbnQodm9sdW1lLmRlc2NyaXB0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICBlZGl0b3Iuc2F2ZSh7IG5vX2V2ZW50czogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghJC50cmltKCQoXCJ0ZXh0YXJlYSNib29rX3Jldmlld19zdW1tYXJ5XCIpLnZhbCgpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICQoXCJ0ZXh0YXJlYSNib29rX3Jldmlld19zdW1tYXJ5XCIpLnZhbCh2b2x1bWUuZGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgJChcIi5lcnJvci1kZXRhaWxzXCIpLnRleHQoYm9va19yZXZpZXdfZ29vZ2xlX2FwaS5ub3RfZm91bmQpLnNob3coKTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYgKGpzb24uaGFzT3duUHJvcGVydHkoXCJzdGF0dXNcIikgJiYgKGpzb24uc3RhdHVzID09PSBcImVycm9yXCIpKSB7XG4gICAgICAgICAgICAkKFwiLmVycm9yLWRldGFpbHNcIikuaHRtbChib29rX3Jldmlld19nb29nbGVfYXBpLnVua25vd25fZXJyb3IpLnNob3coKTtcblxuICAgICAgICAgICAgaWYgKGpzb24uaGFzT3duUHJvcGVydHkoXCJkYXRhXCIpKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgbWVzc2FnZTogXCIgKyBqc29uLmRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiSlNPTiBwYXJzaW5nIGVycm9yOiBcIiArIGUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0pO1xuXG4gIC8vIFBvcHVsYXRlIGZpZWxkIGlmIGl0IGRvZXMgbm90IGFscmVhZHkgY29udGFpbiBhIHZhbHVlLlxuICBmdW5jdGlvbiBzZXRGaWVsZCgkZWxlbSwgdmFsdWUpIHtcbiAgICBpZiAoISQudHJpbSgkZWxlbS52YWwoKSkgJiYgKHZhbHVlICE9PSBudWxsKSkge1xuICAgICAgJGVsZW0udmFsKHZhbHVlKTtcbiAgICB9XG4gIH1cbn0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
