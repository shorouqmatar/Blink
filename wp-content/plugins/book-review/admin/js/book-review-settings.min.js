!function(e){e(function(){function t(){e("#book_review_rating_default").change(n)}function i(){e(".add-field").click(o)}function n(){e("#book_review_rating_default").attr("checked")?e(".rating").hide():e(".rating").show()}function o(){var t=BookReview.Utils.getUniqueId(),i=e("<li/>").attr({"class":"field"}),n=e("<input>").attr({name:"book_review_fields[fields]["+t+"][label]",type:"text","class":"label regular-text",placeholder:custom_fields.placeholder_text}),o=e("<div>").attr({"class":"dashicons dashicons-sort"});i.append(n).append(o),e("#fields").append(i)}var a=new BookReview.Links(e);a.init(),e(".color-picker").wpColorPicker(),t(),i(),n(),e("#fields").sortable({placeholder:"ui-sortable-placeholder"})})}(jQuery);var BookReview=BookReview||{};BookReview.Links=function(e){"use strict";function t(){e(".book-review-admin .site-link").each(function(){i.call(this)}),e(".book-review-admin .custom-image").each(function(){n.call(this)}),e(".book-review-admin .site-link").on("click",i),e(".book-review-admin .links").on("change","input[type='radio']",n),e(".book-review-admin .add-link").on("click",o),e(".book-review-admin").on("click",".set-custom-image",a)}function i(){var t=e(this).attr("data-site-link");t&&t.trim().length>0&&e(".book-review-admin ."+t).toggle(e(this).prop("checked"))}function n(){var t=null,i=null;t=e(this).hasClass("custom-image")?e(this):e(this).parent().parent().find(".custom-image"),t.length>0&&(i=t.siblings(".url-container"),i.length>0&&(t.is(":checked")?i.css("visibility","visible"):i.css("visibility","hidden")))}function o(e){var t=document.getElementById("custom-links").getElementsByTagName("tbody")[0],i=t.querySelectorAll("tr").length+1,n=t.insertRow(),o=n.insertCell(),a=n.insertCell(),l=n.insertCell(),r=document.createElement("input"),s=document.createElement("input"),c=document.createElement("input"),d=document.createElement("input");r.setAttribute("type","hidden"),r.setAttribute("name","book_review_links["+i+"][id]"),s.setAttribute("type","text"),s.setAttribute("name","book_review_links["+i+"][text]"),c.setAttribute("type","text"),c.setAttribute("name","book_review_links["+i+"][image]"),l.className="active",d.setAttribute("type","checkbox"),d.setAttribute("name","book_review_links["+i+"][active]"),d.setAttribute("value","1"),d.setAttribute("checked","checked"),o.appendChild(r),o.appendChild(s),a.appendChild(c),l.appendChild(d)}function a(t){var i=this;t.preventDefault(),r||(r=wp.media.frames.file_frame=wp.media({title:media_uploader.title,button:{text:media_uploader.button_text},multiple:!1})),r.off("select"),r.on("select",function(){l(e(i))}),r.open()}function l(e){var t=r.state().get("selection").first().toJSON();e.prev().val(t.url)}var r=null;return{init:t}};var BookReview=BookReview||{};BookReview.Utils=function(){"use strict";function e(e,i){var n;"undefined"==typeof e&&(e="");var o=function(e,t){return e=parseInt(e,10).toString(16),t<e.length?e.slice(e.length-t):t>e.length?Array(1+(t-e.length)).join("0")+e:e};return t.uniqidSeed||(t.uniqidSeed=Math.floor(123456789*Math.random())),t.uniqidSeed++,n=e,n+=o(parseInt((new Date).getTime()/1e3,10),8),n+=o(t.uniqidSeed,5),i&&(n+=(10*Math.random()).toFixed(8).toString()),"book_review_"+n}var t={};return{getUniqueId:e}}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvb2stcmV2aWV3LXNldHRpbmdzLmpzIl0sIm5hbWVzIjpbIiQiLCJyZWdpc3RlclJhdGluZ0hhbmRsZXJzIiwiY2hhbmdlIiwic2hvd1JhdGluZ0ltYWdlcyIsInJlZ2lzdGVyQ3VzdG9tRmllbGRIYW5kbGVycyIsImNsaWNrIiwiYWRkRmllbGQiLCJhdHRyIiwiaGlkZSIsInNob3ciLCJpZCIsIkJvb2tSZXZpZXciLCJVdGlscyIsImdldFVuaXF1ZUlkIiwiJGxpc3RJdGVtIiwiY2xhc3MiLCIkbGFiZWwiLCJuYW1lIiwidHlwZSIsInBsYWNlaG9sZGVyIiwiY3VzdG9tX2ZpZWxkcyIsInBsYWNlaG9sZGVyX3RleHQiLCIkaWNvbiIsImFwcGVuZCIsImxpbmtzIiwiTGlua3MiLCJpbml0Iiwid3BDb2xvclBpY2tlciIsInNvcnRhYmxlIiwialF1ZXJ5IiwiZWFjaCIsInNldFNpdGVMaW5rVmlzaWJpbGl0eSIsImNhbGwiLCJ0aGlzIiwic2V0VXJsVmlzaWJpbGl0eSIsIm9uIiwiYWRkQ3VzdG9tTGluayIsInNob3dNZWRpYVVwbG9hZGVyIiwic2l0ZUxpbmsiLCJ0cmltIiwibGVuZ3RoIiwidG9nZ2xlIiwicHJvcCIsIiRjdXN0b21JbWFnZSIsIiR1cmxDb250YWluZXIiLCJoYXNDbGFzcyIsInBhcmVudCIsImZpbmQiLCJzaWJsaW5ncyIsImlzIiwiY3NzIiwiZSIsInRib2R5IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicm93Q291bnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwibmV3Um93IiwiaW5zZXJ0Um93IiwibGlua1RleHRDZWxsIiwiaW5zZXJ0Q2VsbCIsImxpbmtJbWFnZUNlbGwiLCJhY3RpdmVDZWxsIiwiaWRUZXh0IiwiY3JlYXRlRWxlbWVudCIsImxpbmtUZXh0IiwibGlua0ltYWdlIiwiYWN0aXZlIiwic2V0QXR0cmlidXRlIiwiY2xhc3NOYW1lIiwiYXBwZW5kQ2hpbGQiLCJzZWxmIiwicHJldmVudERlZmF1bHQiLCJmaWxlRnJhbWUiLCJ3cCIsIm1lZGlhIiwiZnJhbWVzIiwiZmlsZV9mcmFtZSIsInRpdGxlIiwibWVkaWFfdXBsb2FkZXIiLCJidXR0b24iLCJ0ZXh0IiwiYnV0dG9uX3RleHQiLCJtdWx0aXBsZSIsIm9mZiIsInNldEN1c3RvbUltYWdlIiwib3BlbiIsIiRidG4iLCJhdHRhY2htZW50Iiwic3RhdGUiLCJnZXQiLCJmaXJzdCIsInRvSlNPTiIsInByZXYiLCJ2YWwiLCJ1cmwiLCJwcmVmaXgiLCJtb3JlRW50cm9weSIsInJldElkIiwiZm9ybWF0U2VlZCIsInNlZWQiLCJyZXFXaWR0aCIsInBhcnNlSW50IiwidG9TdHJpbmciLCJzbGljZSIsIkFycmF5Iiwiam9pbiIsInBocEpzIiwidW5pcWlkU2VlZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsIkRhdGUiLCJnZXRUaW1lIiwidG9GaXhlZCJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBV0EsR0FDVEEsRUFBRSxXQWtCQSxRQUFTQyxLQUNQRCxFQUFFLCtCQUErQkUsT0FBT0MsR0FJMUMsUUFBU0MsS0FDUEosRUFBRSxjQUFjSyxNQUFNQyxHQUl4QixRQUFTSCxLQUNISCxFQUFFLCtCQUErQk8sS0FBSyxXQUN4Q1AsRUFBRSxXQUFXUSxPQUdiUixFQUFFLFdBQVdTLE9BS2pCLFFBQVNILEtBQ1AsR0FBSUksR0FBS0MsV0FBV0MsTUFBTUMsY0FDeEJDLEVBQVlkLEVBQUUsU0FBU08sTUFBT1EsUUFBUyxVQUN2Q0MsRUFBU2hCLEVBQUUsV0FBV08sTUFDcEJVLEtBQVEsOEJBQWdDUCxFQUFLLFdBQzdDUSxLQUFRLE9BQ1JILFFBQVMscUJBQ1RJLFlBQWVDLGNBQWNDLG1CQUUvQkMsRUFBUXRCLEVBQUUsU0FBU08sTUFBT1EsUUFBUyw0QkFFckNELEdBQVVTLE9BQU9QLEdBQVFPLE9BQU9ELEdBQ2hDdEIsRUFBRSxXQUFXdUIsT0FBT1QsR0FqRHRCLEdBQUlVLEdBQVEsR0FBSWIsWUFBV2MsTUFBTXpCLEVBRWpDd0IsR0FBTUUs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LFlBQWFBLGNBRWpCQSxZQUFXQyxNQUFRLFdBQ2pCLFlBcUJBLFNBQVNDLEdBQVlvRixFQUFRQyxHQUMzQixHQUFJQyxFQUVrQixvQkFBWEYsS0FDVEEsRUFBUyxHQUdYLElBQUlHLEdBQWEsU0FBU0MsRUFBTUMsR0FJOUIsTUFIQUQsR0FBT0UsU0FBU0YsRUFBTSxJQUFJRyxTQUFTLElBRy9CRixFQUFXRCxFQUFLN0QsT0FDWDZELEVBQUtJLE1BQU1KLEVBQUs3RCxPQUFTOEQsR0FJOUJBLEVBQVdELEVBQUs3RCxPQUNYa0UsTUFBTSxHQUFLSixFQUFXRCxFQUFLN0QsU0FBU21FLEtBQUssS0FBT04sRUFHbERBLEVBc0JULE9BbEJLTyxHQUFNQyxhQUNURCxFQUFNQyxXQUFhQyxLQUFLQyxNQUFzQixVQUFoQkQsS0FBS0UsV0FHckNKLEVBQU1DLGFBR05WLEVBQVFGLEVBQ1JFLEdBQVNDLEVBQVdHLFVBQVMsR0FBSVUsT0FBT0MsVUFBWSxJQUFNLElBQUssR0FHL0RmLEdBQVNDLEVBQVdRLEVBQU1DLFdBQVksR0FHbENYLElBQ0ZDLElBQTBCLEdBQWhCVyxLQUFLRSxVQUFlRyxRQUFRLEdBQUdYLFlBR3BDLGVBQWlCTCxFQTdEMUIsR0FBSVMsS0FnRUosUUFDRS9GLFlBQWFBIiwiZmlsZSI6ImJvb2stcmV2aWV3LXNldHRpbmdzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgkKSB7XG4gICQoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGxpbmtzID0gbmV3IEJvb2tSZXZpZXcuTGlua3MoJCk7XG5cbiAgICBsaW5rcy5pbml0KCk7XG5cbiAgICAkKFwiLmNvbG9yLXBpY2tlclwiKS53cENvbG9yUGlja2VyKCk7XG5cbiAgICAvLyBFdmVudCBoYW5kbGVyc1xuICAgIHJlZ2lzdGVyUmF0aW5nSGFuZGxlcnMoKTtcbiAgICByZWdpc3RlckN1c3RvbUZpZWxkSGFuZGxlcnMoKTtcblxuICAgIHNob3dSYXRpbmdJbWFnZXMoKTtcblxuICAgICQoXCIjZmllbGRzXCIpLnNvcnRhYmxlKHtcbiAgICAgIFwicGxhY2Vob2xkZXJcIjogXCJ1aS1zb3J0YWJsZS1wbGFjZWhvbGRlclwiXG4gICAgfSk7XG5cbiAgICAvKiBSZWdpc3RlciBldmVudCBoYW5kbGVycyBmb3IgZWxlbWVudHMgb24gdGhlIFJhdGluZyBJbWFnZXMgdGFiLiAqL1xuICAgIGZ1bmN0aW9uIHJlZ2lzdGVyUmF0aW5nSGFuZGxlcnMoKSB7XG4gICAgICAkKFwiI2Jvb2tfcmV2aWV3X3JhdGluZ19kZWZhdWx0XCIpLmNoYW5nZShzaG93UmF0aW5nSW1hZ2VzKTtcbiAgICB9XG5cbiAgICAvKiBSZWdpc3RlciBldmVudCBoYW5kbGVycyBmb3IgZWxlbWVudHMgb24gdGhlIEN1c3RvbSBGaWVsZHMgdGFiLiAqL1xuICAgIGZ1bmN0aW9uIHJlZ2lzdGVyQ3VzdG9tRmllbGRIYW5kbGVycygpIHtcbiAgICAgICQoXCIuYWRkLWZpZWxkXCIpLmNsaWNrKGFkZEZpZWxkKTtcbiAgICB9XG5cbiAgICAvKiBTaG93IG9yIGhpZGUgUmF0aW5nIEltYWdlIFVSTHMuICovXG4gICAgZnVuY3Rpb24gc2hvd1JhdGluZ0ltYWdlcygpIHtcbiAgICAgIGlmICgkKFwiI2Jvb2tfcmV2aWV3X3JhdGluZ19kZWZhdWx0XCIpLmF0dHIoXCJjaGVja2VkXCIpKSB7XG4gICAgICAgICQoXCIucmF0aW5nXCIpLmhpZGUoKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAkKFwiLnJhdGluZ1wiKS5zaG93KCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyogQWRkIGEgbmV3IGl0ZW0gdG8gdGhlIEN1c3RvbSBGaWVsZHMgbGlzdC4gKi9cbiAgICBmdW5jdGlvbiBhZGRGaWVsZCgpIHtcbiAgICAgIHZhciBpZCA9IEJvb2tSZXZpZXcuVXRpbHMuZ2V0VW5pcXVlSWQoKSxcbiAgICAgICAgJGxpc3RJdGVtID0gJChcIjxsaS8+XCIpLmF0dHIoeyBcImNsYXNzXCI6IFwiZmllbGRcIiB9KSxcbiAgICAgICAgJGxhYmVsID0gJChcIjxpbnB1dD5cIikuYXR0cih7XG4gICAgICAgICAgXCJuYW1lXCI6IFwiYm9va19yZXZpZXdfZmllbGRzW2ZpZWxkc11bXCIgKyBpZCArIFwiXVtsYWJlbF1cIixcbiAgICAgICAgICBcInR5cGVcIjogXCJ0ZXh0XCIsXG4gICAgICAgICAgXCJjbGFzc1wiOiBcImxhYmVsIHJlZ3VsYXItdGV4dFwiLFxuICAgICAgICAgIFwicGxhY2Vob2xkZXJcIjogY3VzdG9tX2ZpZWxkcy5wbGFjZWhvbGRlcl90ZXh0XG4gICAgICAgIH0pLFxuICAgICAgICAkaWNvbiA9ICQoXCI8ZGl2PlwiKS5hdHRyKHsgXCJjbGFzc1wiOiBcImRhc2hpY29ucyBkYXNoaWNvbnMtc29ydFwiIH0pO1xuXG4gICAgICAkbGlzdEl0ZW0uYXBwZW5kKCRsYWJlbCkuYXBwZW5kKCRpY29uKTtcbiAgICAgICQoXCIjZmllbGRzXCIpLmFwcGVuZCgkbGlzdEl0ZW0pO1xuICAgIH1cbiAgfSk7XG59KShqUXVlcnkpO1xudmFyIEJvb2tSZXZpZXcgPSBCb29rUmV2aWV3IHx8IHt9O1xuXG5Cb29rUmV2aWV3LkxpbmtzID0gZnVuY3Rpb24gKCQpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIGZpbGVGcmFtZSA9IG51bGw7XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIC8vIFNldCBpbml0aWFsIHZpc2liaWxpdHkgb2YgZWxlbWVudHMuXG4gICAgJChcIi5ib29rLXJldmlldy1hZG1pbiAuc2l0ZS1saW5rXCIpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICBzZXRTaXRlTGlua1Zpc2liaWxpdHkuY2FsbCh0aGlzKTtcbiAgICB9KTtcblxuICAgICQoXCIuYm9vay1yZXZpZXctYWRtaW4gLmN1c3RvbS1pbWFnZVwiKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgc2V0VXJsVmlzaWJpbGl0eS5jYWxsKHRoaXMpO1xuICAgIH0pO1xuXG4gICAgLy8gQWRkIGV2ZW50IGhhbmRsZXJzLlxuICAgICQoXCIuYm9vay1yZXZpZXctYWRtaW4gLnNpdGUtbGlua1wiKS5vbihcImNsaWNrXCIsIHNldFNpdGVMaW5rVmlzaWJpbGl0eSk7XG4gICAgJChcIi5ib29rLXJldmlldy1hZG1pbiAubGlua3NcIikub24oXCJjaGFuZ2VcIiwgXCJpbnB1dFt0eXBlPSdyYWRpbyddXCIsIHNldFVybFZpc2liaWxpdHkpO1xuICAgICQoXCIuYm9vay1yZXZpZXctYWRtaW4gLmFkZC1saW5rXCIpLm9uKFwiY2xpY2tcIiwgYWRkQ3VzdG9tTGluayk7XG5cbiAgICAkKFwiLmJvb2stcmV2aWV3LWFkbWluXCIpLm9uKFwiY2xpY2tcIiwgXCIuc2V0LWN1c3RvbS1pbWFnZVwiLCBzaG93TWVkaWFVcGxvYWRlcik7XG4gICAgLy8gJChcIi5ib29rLXJldmlldy1hZG1pblwiKS5vbihcImNsaWNrXCIsIFwiLnVwZGF0ZS1uYW1lXCIsIHVwZGF0ZUN1c3RvbUxpbmtUZXh0KTtcbiAgfVxuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG5cbiAgLyogU2V0IHNpdGUgbGluayBzZWN0aW9uIHZpc2liaWxpdHkuICovXG4gIGZ1bmN0aW9uIHNldFNpdGVMaW5rVmlzaWJpbGl0eSgpIHtcbiAgICAvKmpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICB2YXIgc2l0ZUxpbmsgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLXNpdGUtbGlua1wiKTtcblxuICAgIGlmIChzaXRlTGluayAmJiAoc2l0ZUxpbmsudHJpbSgpLmxlbmd0aCA+IDApKSB7XG4gICAgICAkKFwiLmJvb2stcmV2aWV3LWFkbWluIC5cIiArIHNpdGVMaW5rKS50b2dnbGUoJCh0aGlzKS5wcm9wKFwiY2hlY2tlZFwiKSk7XG4gICAgfVxuICB9XG5cbiAgLyogU2V0IFVSTCBmaWVsZCBhbmQgdXBsb2FkIGJ1dHRvbiB2aXNpYmlsaXR5LiAqL1xuICBmdW5jdGlvbiBzZXRVcmxWaXNpYmlsaXR5KCkge1xuICAgIC8qanNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgIHZhciAkY3VzdG9tSW1hZ2UgPSBudWxsLFxuICAgICAgJHVybENvbnRhaW5lciA9IG51bGw7XG5cbiAgICAvLyBDaGVjayBpZiB0aGlzIGlzIGFscmVhZHkgdGhlIEN1c3RvbSBJbWFnZSBidXR0b24uXG4gICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoXCJjdXN0b20taW1hZ2VcIikpIHtcbiAgICAgICRjdXN0b21JbWFnZSA9ICQodGhpcyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgJGN1c3RvbUltYWdlID0gJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKFwiLmN1c3RvbS1pbWFnZVwiKTtcbiAgICB9XG5cbiAgICBpZiAoJGN1c3RvbUltYWdlLmxlbmd0aCA+IDApIHtcbiAgICAgICR1cmxDb250YWluZXIgPSAkY3VzdG9tSW1hZ2Uuc2libGluZ3MoXCIudXJsLWNvbnRhaW5lclwiKTtcblxuICAgICAgLy8gU2V0IHZpc2liaWxpdHkgcHJvcGVydHkgYXMgb3Bwb3NlZCB0byB0aGUgZGlzcGxheSBwcm9wZXJ0eSB0byBwcmV2ZW50IGEgc21hbGwgc2hpZnQgaW4gdGhlXG4gICAgICAvLyBwb3NpdGlvbiBvZiB0aGUgcmFkaW8gYnV0dG9uIHdoZW4gc2VsZWN0ZWQgLyB1bnNlbGVjdGVkLlxuICAgICAgaWYgKCR1cmxDb250YWluZXIubGVuZ3RoID4gMCkge1xuICAgICAgICBpZiAoJGN1c3RvbUltYWdlLmlzKFwiOmNoZWNrZWRcIikpIHtcbiAgICAgICAgICAkdXJsQ29udGFpbmVyLmNzcyhcInZpc2liaWxpdHlcIiwgXCJ2aXNpYmxlXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICR1cmxDb250YWluZXIuY3NzKFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qIEFkZCBVSSBmb3IgY3JlYXRpbmcgYSBjdXN0b20gbGluay4gKi9cbiAgZnVuY3Rpb24gYWRkQ3VzdG9tTGluayhlKSB7XG4gICAgdmFyIHRib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjdXN0b20tbGlua3NcIikuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0Ym9keVwiKVswXSxcbiAgICAgIHJvd0NvdW50ID0gdGJvZHkucXVlcnlTZWxlY3RvckFsbChcInRyXCIpLmxlbmd0aCArIDEsXG4gICAgICBuZXdSb3cgPSB0Ym9keS5pbnNlcnRSb3coKSxcbiAgICAgIGxpbmtUZXh0Q2VsbCA9IG5ld1Jvdy5pbnNlcnRDZWxsKCksXG4gICAgICBsaW5rSW1hZ2VDZWxsID0gbmV3Um93Lmluc2VydENlbGwoKSxcbiAgICAgIGFjdGl2ZUNlbGwgPSBuZXdSb3cuaW5zZXJ0Q2VsbCgpLFxuICAgICAgaWRUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpLFxuICAgICAgbGlua1RleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiksXG4gICAgICBsaW5rSW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiksXG4gICAgICBhY3RpdmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG5cbiAgICAvLyBIaWRkZW4gSUQgZmllbGRcbiAgICBpZFRleHQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcImhpZGRlblwiKTtcbiAgICBpZFRleHQuc2V0QXR0cmlidXRlKFwibmFtZVwiLCBcImJvb2tfcmV2aWV3X2xpbmtzW1wiICsgcm93Q291bnQgKyBcIl1baWRdXCIpO1xuXG4gICAgLy8gTGluayBUZXh0XG4gICAgbGlua1RleHQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInRleHRcIik7XG4gICAgbGlua1RleHQuc2V0QXR0cmlidXRlKFwibmFtZVwiLCBcImJvb2tfcmV2aWV3X2xpbmtzW1wiICsgcm93Q291bnQgKyBcIl1bdGV4dF1cIik7XG5cbiAgICAvLyBMaW5rIEltYWdlIFVSTFxuICAgIGxpbmtJbWFnZS5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwidGV4dFwiKTtcbiAgICBsaW5rSW1hZ2Uuc2V0QXR0cmlidXRlKFwibmFtZVwiLCBcImJvb2tfcmV2aWV3X2xpbmtzW1wiICsgcm93Q291bnQgKyBcIl1baW1hZ2VdXCIpO1xuXG4gICAgLy8gQWN0aXZlXG4gICAgYWN0aXZlQ2VsbC5jbGFzc05hbWUgPSBcImFjdGl2ZVwiO1xuICAgIGFjdGl2ZS5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwiY2hlY2tib3hcIik7XG4gICAgYWN0aXZlLnNldEF0dHJpYnV0ZShcIm5hbWVcIiwgXCJib29rX3Jldmlld19saW5rc1tcIiArIHJvd0NvdW50ICsgXCJdW2FjdGl2ZV1cIik7XG4gICAgYWN0aXZlLnNldEF0dHJpYnV0ZShcInZhbHVlXCIsIFwiMVwiKTtcbiAgICBhY3RpdmUuc2V0QXR0cmlidXRlKFwiY2hlY2tlZFwiLCBcImNoZWNrZWRcIik7XG5cbiAgICBsaW5rVGV4dENlbGwuYXBwZW5kQ2hpbGQoaWRUZXh0KTtcbiAgICBsaW5rVGV4dENlbGwuYXBwZW5kQ2hpbGQobGlua1RleHQpO1xuICAgIGxpbmtJbWFnZUNlbGwuYXBwZW5kQ2hpbGQobGlua0ltYWdlKTtcbiAgICBhY3RpdmVDZWxsLmFwcGVuZENoaWxkKGFjdGl2ZSk7XG4gIH1cblxuICAvKiBVcGRhdGUgdGhlIGxpbmsgdGV4dCBvZiBhIGN1c3RvbSBsaW5rLiAqL1xuICAvLyBmdW5jdGlvbiB1cGRhdGVDdXN0b21MaW5rVGV4dChlKSB7XG4gIC8vICAgIC8qanNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAvLyAgIHZhciAkbmFtZSA9ICQodGhpcykuc2libGluZ3MoXCIubmFtZVwiKSxcbiAgLy8gICAgICRoZWFkaW5nID0gJCh0aGlzKS5jbG9zZXN0KFwiLmN1c3RvbVwiKS5maW5kKFwiLmhlYWRpbmdcIiksXG4gIC8vICAgICAkbGluayA9ICQodGhpcykuY2xvc2VzdChcIi5jdXN0b21cIikuZmluZChcIi5saW5rXCIpO1xuXG4gIC8vICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIC8vICAgLy8gU2V0IGN1c3RvbSBsaW5rIGhlYWRpbmcgdGV4dC5cbiAgLy8gICBpZiAoKCRuYW1lLmxlbmd0aCA+IDApICYmICgkbmFtZS52YWwoKSAhPT0gXCJcIikpIHtcbiAgLy8gICAgIGlmICgkaGVhZGluZy5sZW5ndGggPiAwKSB7XG4gIC8vICAgICAgICRoZWFkaW5nLnRleHQoJG5hbWUudmFsKCkpO1xuICAvLyAgICAgfVxuXG4gIC8vICAgICBpZiAoJGxpbmsubGVuZ3RoID4gMCkge1xuICAvLyAgICAgICAkbGluay50ZXh0KCRuYW1lLnZhbCgpKTtcbiAgLy8gICAgIH1cblxuICAvLyAgICAgJChcIi5ib29rLXJldmlldy1hZG1pbiAuY3VzdG9tIC5lcnJvci1kZXRhaWxzXCIpLmhpZGUoKTtcblxuICAvLyAgICAgLy8gU2hvdyBuZXh0IHN0ZXAuXG4gIC8vICAgICAkKFwiLmJvb2stcmV2aWV3LWFkbWluIC5jdXN0b20gLmxpbmstdHlwZXNcIikuc2hvdygpO1xuICAvLyAgIH1cbiAgLy8gICBlbHNlIHtcbiAgLy8gICAgICQoXCIuYm9vay1yZXZpZXctYWRtaW4gLmN1c3RvbSAuZXJyb3ItZGV0YWlsc1wiKS5zaG93KCk7XG4gIC8vICAgfVxuICAvLyB9XG5cbiAgLyogU2hvdyB0aGUgbWVkaWEgdXBsb2FkZXIuICovXG4gIGZ1bmN0aW9uIHNob3dNZWRpYVVwbG9hZGVyKGUpIHtcbiAgICAgLypqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgLy8gQ3JlYXRlIHRoZSBtZWRpYSBmcmFtZS5cbiAgICBpZiAoIWZpbGVGcmFtZSkge1xuICAgICAgZmlsZUZyYW1lID0gd3AubWVkaWEuZnJhbWVzLmZpbGVfZnJhbWUgPSB3cC5tZWRpYSh7XG4gICAgICAgIHRpdGxlOiBtZWRpYV91cGxvYWRlci50aXRsZSxcbiAgICAgICAgYnV0dG9uOiB7XG4gICAgICAgICAgdGV4dDogbWVkaWFfdXBsb2FkZXIuYnV0dG9uX3RleHRcbiAgICAgICAgfSxcbiAgICAgICAgbXVsdGlwbGU6IGZhbHNlXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBSZW1vdmUgYW55IGV4aXN0aW5nIGV2ZW50IGhhbmRsZXJzLlxuICAgIGZpbGVGcmFtZS5vZmYoXCJzZWxlY3RcIik7XG5cbiAgICAvLyBIYW5kbGUgYW4gaW1hZ2UgYmVpbmcgc2VsZWN0ZWQuXG4gICAgZmlsZUZyYW1lLm9uKFwic2VsZWN0XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgc2V0Q3VzdG9tSW1hZ2UoJChzZWxmKSk7XG4gICAgfSk7XG5cbiAgICBmaWxlRnJhbWUub3BlbigpO1xuICB9XG5cbiAgLyogSGFuZGxlIGN1c3RvbSBpbWFnZSBzZWxlY3Rpb24uICovXG4gIGZ1bmN0aW9uIHNldEN1c3RvbUltYWdlKCRidG4pIHtcbiAgICB2YXIgYXR0YWNobWVudCA9IGZpbGVGcmFtZS5zdGF0ZSgpLmdldChcInNlbGVjdGlvblwiKS5maXJzdCgpLnRvSlNPTigpO1xuXG4gICAgLy8gU2V0IHRoZSBVUkwgaW4gdGhlIGFwcHJvcHJpYXRlIGZpZWxkLlxuICAgICRidG4ucHJldigpLnZhbChhdHRhY2htZW50LnVybCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiaW5pdFwiOiBpbml0XG4gIH07XG59O1xuXG52YXIgQm9va1JldmlldyA9IEJvb2tSZXZpZXcgfHwge307XG5cbkJvb2tSZXZpZXcuVXRpbHMgPSAoZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgcGhwSnMgPSB7fTtcblxuICAvKlxuICAgKiAgUHVibGljICBNZXRob2RzXG4gICAqL1xuXG4gIC8qIEdlbmVyYXRlIGEgdW5pcXVlIElELiBCYXNlZCBvbiBQSFAncyB1bmlxaWQgZnVuY3Rpb24uXG4gICAqIGRpc2N1c3MgYXQ6IGh0dHA6Ly9waHBqcy5vcmcvZnVuY3Rpb25zL3VuaXFpZC9cbiAgICogb3JpZ2luYWwgYnk6IEtldmluIHZhbiBab25uZXZlbGQgKGh0dHA6Ly9rZXZpbi52YW56b25uZXZlbGQubmV0KVxuICAgKiAgcmV2aXNlZCBieTogS2Fua3JlbHVuZSAoaHR0cDovL3d3dy53ZWJmYWt0b3J5LmluZm8vKVxuICAgKiAgICAgICAgbm90ZTogVXNlcyBhbiBpbnRlcm5hbCBjb3VudGVyIChpbiBwaHBKcyBnbG9iYWwpIHRvIGF2b2lkIGNvbGxpc2lvblxuICAgKiAgICAgICAgdGVzdDogc2tpcFxuICAgKiAgIGV4YW1wbGUgMTogdW5pcWlkKCk7XG4gICAqICAgcmV0dXJucyAxOiBcImEzMDI4NWIxNjBjMTRcIlxuICAgKiAgIGV4YW1wbGUgMjogdW5pcWlkKFwiZm9vXCIpO1xuICAgKiAgIHJldHVybnMgMjogXCJmb29hMzAyODViMWNkMzYxXCJcbiAgICogICBleGFtcGxlIDM6IHVuaXFpZChcImJhclwiLCB0cnVlKTtcbiAgICogICByZXR1cm5zIDM6IFwiYmFyYTIwMjg1YjIzZGZkMS4zMTg3OTA4N1wiXG4gICAqL1xuICBmdW5jdGlvbiBnZXRVbmlxdWVJZChwcmVmaXgsIG1vcmVFbnRyb3B5KSB7XG4gICAgdmFyIHJldElkO1xuXG4gICAgaWYgKHR5cGVvZiBwcmVmaXggPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIHByZWZpeCA9IFwiXCI7XG4gICAgfVxuXG4gICAgdmFyIGZvcm1hdFNlZWQgPSBmdW5jdGlvbihzZWVkLCByZXFXaWR0aCkge1xuICAgICAgc2VlZCA9IHBhcnNlSW50KHNlZWQsIDEwKS50b1N0cmluZygxNik7IC8vIFRvIGhleCBzdHJpbmdcblxuICAgICAgLy8gU28gbG9uZyB3ZSBzcGxpdC5cbiAgICAgIGlmIChyZXFXaWR0aCA8IHNlZWQubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBzZWVkLnNsaWNlKHNlZWQubGVuZ3RoIC0gcmVxV2lkdGgpO1xuICAgICAgfVxuXG4gICAgICAvLyBTbyBzaG9ydCB3ZSBwYWQuXG4gICAgICBpZiAocmVxV2lkdGggPiBzZWVkLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gQXJyYXkoMSArIChyZXFXaWR0aCAtIHNlZWQubGVuZ3RoKSkuam9pbihcIjBcIikgKyBzZWVkO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc2VlZDtcbiAgICB9O1xuXG4gICAgLy8gSW5pdCBzZWVkIHdpdGggYmlnIHJhbmRvbSBpbnQuXG4gICAgaWYgKCFwaHBKcy51bmlxaWRTZWVkKSB7XG4gICAgICBwaHBKcy51bmlxaWRTZWVkID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMHg3NWJjZDE1KTtcbiAgICB9XG5cbiAgICBwaHBKcy51bmlxaWRTZWVkKys7XG5cbiAgICAvLyBTdGFydCB3aXRoIHByZWZpeCwgYWRkIGN1cnJlbnQgbWlsbGlzZWNvbmRzIGhleCBzdHJpbmcuXG4gICAgcmV0SWQgPSBwcmVmaXg7XG4gICAgcmV0SWQgKz0gZm9ybWF0U2VlZChwYXJzZUludChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDAsIDEwKSwgOCk7XG5cbiAgICAvLyBBZGQgc2VlZCBoZXggc3RyaW5nLlxuICAgIHJldElkICs9IGZvcm1hdFNlZWQocGhwSnMudW5pcWlkU2VlZCwgNSk7XG5cbiAgICAvLyBGb3IgbW9yZSBlbnRyb3B5IHdlIGFkZCBhIGZsb2F0IGxvd2VyIHRvIDEwLlxuICAgIGlmIChtb3JlRW50cm9weSkge1xuICAgICAgcmV0SWQgKz0gKE1hdGgucmFuZG9tKCkgKiAxMCkudG9GaXhlZCg4KS50b1N0cmluZygpO1xuICAgIH1cblxuICAgIHJldHVybiBcImJvb2tfcmV2aWV3X1wiICsgcmV0SWQ7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGdldFVuaXF1ZUlkOiBnZXRVbmlxdWVJZFxuICB9O1xufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
